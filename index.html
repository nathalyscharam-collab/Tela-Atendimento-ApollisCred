
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tela de Atendimento - Supabase</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f9; padding: 20px; }
    h1 { text-align: center; }
    .form-container, .table-container { background: #fff; padding: 20px; margin: 20px auto; border-radius: 10px; max-width: 1000px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .form-group { margin-bottom: 15px; }
    label { display: block; font-weight: bold; margin-bottom: 5px; }
    input, select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
    button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 16px; }
    button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    th { background: #007bff; color: #fff; }
    .actions button { margin: 0 5px; padding: 5px 10px; font-size: 14px; }
    .edit { background: #28a745; }
    .delete { background: #dc3545; }
  </style>
</head>
<body>
  <h1>Tela de Atendimento</h1>

  <div class="form-container">
    <h2>Novo Atendimento</h2>
    <div class="form-group"><label>Nome do Cliente</label><input type="text" id="nome"></div>
    <div class="form-group"><label>Telefone do Cliente</label><input type="text" id="telefone"></div>
    <div class="form-group"><label>CPF</label><input type="text" id="cpf"></div>
    <div class="form-group"><label>Benefício Liberado</label><input type="text" id="beneficio"></div>
    <div class="form-group"><label>Valor Liberado (R$)</label><input type="number" id="valor"></div>
    <div class="form-group"><label>Parcelas</label><input type="number" id="parcelas"></div>
    <div class="form-group"><label>Status da Conversa</label>
      <select id="status">
        <option>Em andamento</option>
        <option>Finalizado</option>
        <option>Pendente</option>
        <option>Sem contato</option>
      </select>
    </div>
    <div class="form-group"><label>Consultor Responsável</label><input type="text" id="consultor"></div>
    <button onclick="adicionarAtendimento()">Salvar Atendimento</button>
  </div>

  <div class="table-container">
    <h2>Atendimentos</h2>
    <table id="tabela">
      <thead>
        <tr>
          <th>Nome</th><th>Telefone</th><th>CPF</th><th>Benefício</th><th>Valor (R$)</th><th>Parcelas</th>
          <th>Status</th><th>Consultor</th><th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const SUPABASE_URL = 'https://gezmqvigancqhcpevozd.supabase.co'
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdlem1xdmlnYW5jcWhjcGV2b3pkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MDI3OTUsImV4cCI6MjA3MjQ3ODc5NX0.4OKMFIz-YWIEIe46_1ZYnDisHSA-4jr-Cnd50zAZ3ug'

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    async function salvarAtendimento(atendimento) {
      const { error } = await supabase.from('atendimentos').insert([atendimento])
      if (error) return alert('Erro ao salvar: ' + error.message)
    }

    function popularTabela(atendimentos) {
      const tbody = document.querySelector('#tabela tbody')
      tbody.innerHTML = ''
      atendimentos.forEach(a => {
        const tr = document.createElement('tr')
        tr.innerHTML = `
          <td>${a.nome}</td>
          <td>${a.telefone||''}</td>
          <td>${a.cpf||''}</td>
          <td>${a.beneficio||''}</td>
          <td>${a.valor||''}</td>
          <td>${a.parcelas||''}</td>
          <td>${a.status||''}</td>
          <td>${a.consultor||''}</td>
          <td>
            <button class="edit" onclick="editarLinha(this)">Editar</button>
            <button class="delete" onclick="deletarLinhaSupabase(${a.id})">Excluir</button>
          </td>`
        tbody.appendChild(tr)
      })
    }

    async function carregarAtendimentos() {
      const { data, error } = await supabase.from('atendimentos').select('*').order('created_at', { ascending: false })
      if (error) return console.error(error)
      popularTabela(data || [])
    }
    carregarAtendimentos()

    supabase.channel('table-changes')
      .on('postgres_changes', { event: '*', schema: 'public', table: 'atendimentos' }, () => {
        carregarAtendimentos()
      })
      .subscribe()

    window.adicionarAtendimento = async function() {
      const atendimento = {
        nome: document.getElementById('nome').value,
        telefone: document.getElementById('telefone').value,
        cpf: document.getElementById('cpf').value,
        beneficio: document.getElementById('beneficio').value,
        valor: parseFloat(document.getElementById('valor').value || 0),
        parcelas: parseInt(document.getElementById('parcelas').value || 0),
        status: document.getElementById('status').value,
        consultor: document.getElementById('consultor').value
      }
      if (!atendimento.nome || !atendimento.cpf) return alert('Preencha nome e CPF')
      await salvarAtendimento(atendimento)
      document.querySelectorAll('.form-group input, .form-group select').forEach(i => i.value = '')
    }

    window.deletarLinhaSupabase = async function(id) {
      await supabase.from('atendimentos').delete().eq('id', id)
      carregarAtendimentos()
    }

    window.editarLinha = function(botao) {
      const row = botao.closest('tr')
      const cells = row.getElementsByTagName('td')
      document.getElementById('nome').value = cells[0].innerText
      document.getElementById('telefone').value = cells[1].innerText
      document.getElementById('cpf').value = cells[2].innerText
      document.getElementById('beneficio').value = cells[3].innerText
      document.getElementById('valor').value = cells[4].innerText
      document.getElementById('parcelas').value = cells[5].innerText
      document.getElementById('status').value = cells[6].innerText
      document.getElementById('consultor').value = cells[7].innerText
      row.remove()
    }
  </script>
</body>
</html>
